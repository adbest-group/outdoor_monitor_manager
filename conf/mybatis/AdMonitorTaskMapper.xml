<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bt.om.mapper.AdMonitorTaskMapper">
	<resultMap id="BaseResultMap" type="com.bt.om.entity.AdMonitorTask">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Jan 20 
			10:48:02 CST 2018. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="activity_id" property="activityId" jdbcType="INTEGER" />
		<result column="activity_adseat_id" property="activityAdseatId"
			jdbcType="INTEGER" />
		<result column="task_type" property="taskType" jdbcType="INTEGER" />
		<result column="user_id" property="userId" jdbcType="INTEGER" />
		<result column="status" property="status" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Jan 20 
			10:48:02 CST 2018. -->
		id, activity_id, activity_adseat_id, task_type, user_id, status,
		create_time, update_time
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Jan 20 
			10:48:02 CST 2018. -->
		select
		<include refid="Base_Column_List" />
		from ad_monitor_task
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Jan 20 
			10:48:02 CST 2018. -->
		delete from ad_monitor_task
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.bt.om.entity.AdMonitorTask">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Jan 20 
			10:48:02 CST 2018. -->
		insert into ad_monitor_task (id, activity_id, activity_adseat_id,
		task_type, user_id, status,
		create_time, update_time)
		values
		(#{id,jdbcType=INTEGER}, #{activityId,jdbcType=INTEGER},
		#{activityAdseatId,jdbcType=INTEGER},
		#{taskType,jdbcType=INTEGER},
		#{userId,jdbcType=INTEGER}, #{status,jdbcType=INTEGER},
		#{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP})
	</insert>
	<insert id="insertSelective" parameterType="com.bt.om.entity.AdMonitorTask">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Jan 20 
			10:48:02 CST 2018. -->
		insert into ad_monitor_task
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="activityId != null">
				activity_id,
			</if>
			<if test="activityAdseatId != null">
				activity_adseat_id,
			</if>
			<if test="taskType != null">
				task_type,
			</if>
			<if test="userId != null">
				user_id,
			</if>
			<if test="status != null">
				status,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="activityId != null">
				#{activityId,jdbcType=INTEGER},
			</if>
			<if test="activityAdseatId != null">
				#{activityAdseatId,jdbcType=INTEGER},
			</if>
			<if test="taskType != null">
				#{taskType,jdbcType=INTEGER},
			</if>
			<if test="userId != null">
				#{userId,jdbcType=INTEGER},
			</if>
			<if test="status != null">
				#{status,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.bt.om.entity.AdMonitorTask">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Jan 20 
			10:48:02 CST 2018. -->
		update ad_monitor_task
		<set>
			<if test="activityId != null">
				activity_id = #{activityId,jdbcType=INTEGER},
			</if>
			<if test="activityAdseatId != null">
				activity_adseat_id =
				#{activityAdseatId,jdbcType=INTEGER},
			</if>
			<if test="taskType != null">
				task_type = #{taskType,jdbcType=INTEGER},
			</if>
			<if test="userId != null">
				user_id = #{userId,jdbcType=INTEGER},
			</if>
			<if test="status != null">
				status = #{status,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.bt.om.entity.AdMonitorTask">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Jan 20 
			10:48:02 CST 2018. -->
		update ad_monitor_task
		set activity_id =
		#{activityId,jdbcType=INTEGER},
		activity_adseat_id =
		#{activityAdseatId,jdbcType=INTEGER},
		task_type =
		#{taskType,jdbcType=INTEGER},
		user_id = #{userId,jdbcType=INTEGER},
		status = #{status,jdbcType=INTEGER},
		create_time =
		#{createTime,jdbcType=TIMESTAMP},
		update_time =
		#{updateTime,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<resultMap id="ExtResultMap" extends="BaseResultMap"
		type="com.bt.om.entity.vo.AdMonitorTaskVo">
		<result column="activity_name" jdbcType="VARCHAR" property="activityName" />
		<result column="sample_pic_url" jdbcType="VARCHAR" property="samplePicUrl" />
		<result column="start_time" jdbcType="TIMESTAMP" property="startTime" />
		<result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
		<result column="province" jdbcType="INTEGER" property="province" />
		<result column="city" jdbcType="INTEGER" property="city" />
		<result column="region" jdbcType="INTEGER" property="region" />
		<result column="street" jdbcType="INTEGER" property="street" />
		<result column="media_name" jdbcType="VARCHAR" property="mediaName" />
		<result column="ad_seat_name" jdbcType="VARCHAR" property="adSeatName" />
		<result column="realname" jdbcType="VARCHAR" property="realname" />
		<result column="monitor_start" jdbcType="TIMESTAMP" property="monitorsStart" />
		<result column="monitor_end" jdbcType="TIMESTAMP" property="monitorsEnd" />
		<result column="brand" jdbcType="VARCHAR" property="brand" />
		<result column="status" jdbcType="INTEGER" property="status"/>
		<result column="problem" jdbcType="VARCHAR" property="problem"/>
		<result column="problem_other" jdbcType="VARCHAR" property="problemOther"/>
		<result column="pic_url1" jdbcType="VARCHAR" property="picUrl1"/>
		<result column="pic_url2" jdbcType="VARCHAR" property="picUrl2"/>
		<result column="pic_url3" jdbcType="VARCHAR" property="picUrl3"/>
		<result column="pic_url4" jdbcType="VARCHAR" property="picUrl4"/>
		<result column="feedbackstatus" jdbcType="INTEGER" property="feedbackStatus"/>
		<result column="feedbackcreatetime" jdbcType="TIMESTAMP" property="feedbackCreateTime"/>
	</resultMap>

  <resultMap id="MobileResultMap" extends="BaseResultMap" type="com.bt.om.entity.vo.AdMonitorTaskMobileVo">
    <result column="activity_name" jdbcType="VARCHAR" property="activityName" />
    <result column="sample_pic_url" jdbcType="VARCHAR" property="samplePicUrl" />
    <result column="monitor_start" jdbcType="VARCHAR" property="monitorStart" />
    <result column="monitor_end" jdbcType="VARCHAR" property="monitorEnd" />
    <result column="ad_seat_id" jdbcType="INTEGER" property="adSeatId" />
    <result column="ad_seat_name" jdbcType="VARCHAR" property="adSeatName" />
    <result column="pic_url1" jdbcType="VARCHAR" property="picUrl1" />
    <result column="pic_url2" jdbcType="VARCHAR" property="picUrl2" />
    <result column="pic_url3" jdbcType="VARCHAR" property="picUrl3" />
    <result column="pic_url4" jdbcType="VARCHAR" property="picUrl4" />
    <result column="feedback_time" jdbcType="VARCHAR" property="feedbackTime" />
    <result column="problem" jdbcType="VARCHAR" property="problem" />
    <result column="problem_other" jdbcType="VARCHAR" property="problemOther" />
  </resultMap>

  <insert id="insertList" parameterType="java.util.List">
    insert into ad_monitor_task (id, activity_id, activity_adseat_id,
    task_type, user_id, status,
    create_time, update_time)
    values
    <foreach collection="tasks" item="task" separator=",">
      (#{id,jdbcType=INTEGER}, #{activityId,jdbcType=INTEGER}, #{activityAdseatId,jdbcType=INTEGER},
      #{taskType,jdbcType=INTEGER}, #{userId,jdbcType=INTEGER}, #{status,jdbcType=INTEGER},
      #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP})
    </foreach>
  </insert>

	<delete id="deleteByActivityId" parameterType="java.lang.Integer">
		delete from
		ad_monitor_task
		where activity_id = #{activityId,jdbcType=INTEGER}
	</delete>

	<select id="getPageCount" parameterType="map" resultType="int">
		select count(a.id)
		from ad_monitor_task a
		left join ad_activity b on
		a.activity_id = b.id
		left join ad_activity_adseat c on
		a.activity_adseat_id = c.id
		left join ad_seat_info d on c.ad_seat_id =
		d.id
		left join ad_media e on c.media_id = e.id
		where 1=1
		<if test="activityId != null">
			and a.activity_id = #{activityId,jdbcType=INTEGER}
		</if>
		<if test="status != null">
			and a.status = #{status,jdbcType=INTEGER}
		</if>
		<if test="startDate != null">
			and b.start_time >=
			DATE_FORMAT(#{startDate,jdbcType=TIMESTAMP},'%Y-%m-%d')
		</if>
		<if test="endDate != null">
			and b.end_time &lt;=
			DATE_FORMAT(#{endDate,jdbcType=TIMESTAMP},'%Y-%m-%d')
		</if>
	</select>

  <select id="getPageData" parameterType="map" resultMap="ExtResultMap">
    select a.id, a.activity_id, a.activity_adseat_id, a.task_type, a.user_id, a.status, a.create_time, a.update_time,
    b.activity_name,c.sample_pic_url,b.start_time,b.end_time,d.province,d.city,d.region,d.street,e.media_name,d.`name` as ad_seat_name,
    f.realname
    from ad_monitor_task a
    left join ad_activity b on a.activity_id = b.id
    left join ad_activity_adseat c on a.activity_adseat_id = c.id
    left join ad_seat_info d on c.ad_seat_id = d.id
    left join ad_media e on c.media_id = e.id
    left join sys_user_execute f on a.user_id = f.id
    where 1=1
    <if test="activityId != null" >
      and a.activity_id = #{activityId,jdbcType=INTEGER}
    </if>
    <if test="status != null" >
      and a.status = #{status,jdbcType=INTEGER}
    </if>
    <if test="startDate != null" >
      and b.start_time >= DATE_FORMAT(#{startDate,jdbcType=TIMESTAMP},'%Y-%m-%d')
    </if>
    <if test="endDate != null" >
      and b.end_time &lt;= DATE_FORMAT(#{endDate,jdbcType=TIMESTAMP},'%Y-%m-%d')
    </if>
    order by a.id desc
  </select>

  <select id="selectByUserId" resultMap="MobileResultMap">
    select a.id, a.activity_id, a.activity_adseat_id, a.task_type, a.user_id, a.status, a.create_time, a.update_time,
    b.activity_name,c.sample_pic_url,c.monitor_start,c.monitor_end,c.ad_seat_id,d.`name` as ad_seat_name,e.reason,e.pic_url1,e.pic_url2,e.pic_url3,e.pic_url4,e.create_time as feedback_time,
    e.problem,e.problem_other
    from ad_monitor_task a
    left join ad_activity b on a.activity_id = b.id
    left join ad_activity_adseat c on a.activity_adseat_id = c.id
    left join ad_seat_info d on c.ad_seat_id = d.id
    left join ad_monitor_task_feedback e on e.monitor_task_id = a.id and e.`status` = 1
    where a.user_id = #{userId,jdbcType=INTEGER}
    order by a.id desc
  </select>

	<select id="getTaskDetails" resultMap="ExtResultMap">
		select 
			activity.`activity_name`,
			activity.`start_time`, 
			activity.`end_time`, 
			activity.`create_time`,
			`adseat`.`monitor_start`,
			`adseat`.`monitor_end`,
			`adseat`.`brand`,
			`adseat`.`sample_pic_url`,
			`seatinfo`.`province`,
			`seatinfo`.`city`,
			`seatinfo`.`region`,
			`seatinfo`.`street`,
			seatinfo.name,
			`media`.`media_name`
		from 
			ad_monitor_task as task 
			left join `ad_activity` as activity on task.`activity_id`=`activity`.id
			left join ad_activity_adseat as adseat on task.activity_adseat_id=adseat.id
			left join ad_seat_info as seatinfo on adseat.ad_seat_id =seatinfo.id
			left join ad_media as media on adseat.media_id=media.id
		where 
			task.id=#{taskId,jdbcType=INTEGER}

	</select>
	
	<select id="getSubmitDetails" resultMap="ExtResultMap">
		select
			task.status,
			activity.activity_name,
			seatinfo.province,
			seatinfo.city,
			seatinfo.region,
			seatinfo.street,
			adseat.monitor_start,
			feedback.problem,
			feedback.pic_url1,
			feedback.pic_url2,
			feedback.pic_url3,
			feedback.pic_url4,
			feedback.problem_other,
			feedback.create_time feedbackcreatetime,
			feedback.status feedbackstatus,
			task.task_type
		from
			ad_monitor_task_feedback feedback
            left join `ad_monitor_task` as task on task.id=feedback.monitor_task_id
			left join ad_activity as activity on task.activity_id=activity.id
		    left join ad_activity_adseat as adseat on task.activity_adseat_id=adseat.id
		    left join ad_seat_info as seatinfo on adseat.ad_seat_id=seatinfo.id
		where
			task.id=#{taskId,jdbcType=INTEGER}
	</select>
</mapper>
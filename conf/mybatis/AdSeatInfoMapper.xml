<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bt.om.mapper.AdSeatInfoMapper">
	<resultMap id="BaseResultMap" type="com.bt.om.entity.AdSeatInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Feb 01 
			13:48:16 CST 2018. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="province" property="province" jdbcType="BIGINT" />
		<result column="city" property="city" jdbcType="BIGINT" />
		<result column="region" property="region" jdbcType="BIGINT" />
		<result column="street" property="street" jdbcType="BIGINT" />
		<result column="media_id" property="mediaId" jdbcType="INTEGER" />
		<result column="ad_seat_type" property="adSeatType" jdbcType="INTEGER" />
		<result column="ad_seat_type_text" property="adSeatTypeText" jdbcType="VARCHAR" />
		<result column="ad_code" property="adCode" jdbcType="VARCHAR" />
		<result column="location" property="location" jdbcType="VARCHAR" />
		<result column="ad_size" property="adSize" jdbcType="VARCHAR" />
		<result column="pv" property="pv" jdbcType="INTEGER" />
		<result column="private_car_pv" property="privateCarPv"
			jdbcType="INTEGER" />
		<result column="bus_pv" property="busPv" jdbcType="INTEGER" />
		<result column="lon" property="lon" jdbcType="DOUBLE" />
		<result column="lat" property="lat" jdbcType="DOUBLE" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
	</resultMap>

	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Feb 01 
			13:48:16 CST 2018. -->
		id, name, province, city, region, street, media_id, ad_seat_type, ad_seat_type_text,
		ad_code, location,
		ad_size, pv, private_car_pv, bus_pv, lon, lat,
		create_time, update_time
	</sql>

	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Feb 01 
			13:48:16 CST 2018. -->
		select
		<include refid="Base_Column_List" />
		from ad_seat_info
		where id = #{id,jdbcType=INTEGER}
	</select>

	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Feb 01 
			13:48:16 CST 2018. -->
		delete from ad_seat_info
		where id = #{id,jdbcType=INTEGER}
	</delete>

	<insert id="insert" parameterType="com.bt.om.entity.AdSeatInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Feb 01 
			13:48:16 CST 2018. -->
		insert into ad_seat_info (id, name, province,
		city, region, street,
		media_id, ad_seat_type, ad_code,
		location, ad_size, pv,
		private_car_pv,
		bus_pv, lon,
		lat, create_time, update_time
		)
		values
		(#{id,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR},
		#{province,jdbcType=BIGINT},
		#{city,jdbcType=BIGINT},
		#{region,jdbcType=BIGINT}, #{street,jdbcType=BIGINT},
		#{mediaId,jdbcType=INTEGER}, #{adSeatType,jdbcType=INTEGER},
		#{adCode,jdbcType=VARCHAR},
		#{location,jdbcType=VARCHAR},
		#{adSize,jdbcType=VARCHAR}, #{pv,jdbcType=INTEGER},
		#{privateCarPv,jdbcType=INTEGER}, #{busPv,jdbcType=INTEGER},
		#{lon,jdbcType=DOUBLE},
		#{lat,jdbcType=DOUBLE},
		#{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}
		)
	</insert>

	<insert id="insertSelective" useGeneratedKeys="true" keyProperty="id" parameterType="com.bt.om.entity.AdSeatInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Feb 01 
			13:48:16 CST 2018. -->
		insert into ad_seat_info
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="province != null">
				province,
			</if>
			<if test="city != null">
				city,
			</if>
			<if test="region != null">
				region,
			</if>
			<if test="street != null">
				street,
			</if>
			<if test="mediaId != null">
				media_id,
			</if>
			<if test="adSeatType != null">
				ad_seat_type,
			</if>
			<if test="adCode != null">
				ad_code,
			</if>
			<if test="location != null">
				location,
			</if>
			<if test="adSize != null">
				ad_size,
			</if>
			<if test="pv != null">
				pv,
			</if>
			<if test="privateCarPv != null">
				private_car_pv,
			</if>
			<if test="busPv != null">
				bus_pv,
			</if>
			<if test="lon != null">
				lon,
			</if>
			<if test="lat != null">
				lat,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="province != null">
				#{province,jdbcType=BIGINT},
			</if>
			<if test="city != null">
				#{city,jdbcType=BIGINT},
			</if>
			<if test="region != null">
				#{region,jdbcType=BIGINT},
			</if>
			<if test="street != null">
				#{street,jdbcType=BIGINT},
			</if>
			<if test="mediaId != null">
				#{mediaId,jdbcType=INTEGER},
			</if>
			<if test="adSeatType != null">
				#{adSeatType,jdbcType=INTEGER},
			</if>
			<if test="adCode != null">
				#{adCode,jdbcType=VARCHAR},
			</if>
			<if test="location != null">
				#{location,jdbcType=VARCHAR},
			</if>
			<if test="adSize != null">
				#{adSize,jdbcType=VARCHAR},
			</if>
			<if test="pv != null">
				#{pv,jdbcType=INTEGER},
			</if>
			<if test="privateCarPv != null">
				#{privateCarPv,jdbcType=INTEGER},
			</if>
			<if test="busPv != null">
				#{busPv,jdbcType=INTEGER},
			</if>
			<if test="lon != null">
				#{lon,jdbcType=DOUBLE},
			</if>
			<if test="lat != null">
				#{lat,jdbcType=DOUBLE},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>

	<update id="updateByPrimaryKeySelective" parameterType="com.bt.om.entity.AdSeatInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Feb 01 
			13:48:16 CST 2018. -->
		update ad_seat_info
		<set>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="province != null">
				province = #{province,jdbcType=BIGINT},
			</if>
			<if test="city != null">
				city = #{city,jdbcType=BIGINT},
			</if>
			<if test="region != null">
				region = #{region,jdbcType=BIGINT},
			</if>
			<if test="street != null">
				street = #{street,jdbcType=BIGINT},
			</if>
			<if test="mediaId != null">
				media_id = #{mediaId,jdbcType=INTEGER},
			</if>
			<if test="adSeatType != null">
				ad_seat_type = #{adSeatType,jdbcType=INTEGER},
			</if>
			<if test="adCode != null">
				ad_code = #{adCode,jdbcType=VARCHAR},
			</if>
			<if test="location != null">
				location = #{location,jdbcType=VARCHAR},
			</if>
			<if test="adSize != null">
				ad_size = #{adSize,jdbcType=VARCHAR},
			</if>
			<if test="pv != null">
				pv = #{pv,jdbcType=INTEGER},
			</if>
			<if test="privateCarPv != null">
				private_car_pv = #{privateCarPv,jdbcType=INTEGER},
			</if>
			<if test="busPv != null">
				bus_pv = #{busPv,jdbcType=INTEGER},
			</if>
			<if test="lon != null">
				lon = #{lon,jdbcType=DOUBLE},
			</if>
			<if test="lat != null">
				lat = #{lat,jdbcType=DOUBLE},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.bt.om.entity.AdSeatInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Feb 01 
			13:48:16 CST 2018. -->
		update ad_seat_info
		set name = #{name,jdbcType=VARCHAR},
		province =
		#{province,jdbcType=BIGINT},
		city = #{city,jdbcType=BIGINT},
		region =
		#{region,jdbcType=BIGINT},
		street = #{street,jdbcType=BIGINT},
		media_id = #{mediaId,jdbcType=INTEGER},
		ad_seat_type =
		#{adSeatType,jdbcType=INTEGER},
		ad_code = #{adCode,jdbcType=VARCHAR},
		location = #{location,jdbcType=VARCHAR},
		ad_size =
		#{adSize,jdbcType=VARCHAR},
		pv = #{pv,jdbcType=INTEGER},
		private_car_pv
		= #{privateCarPv,jdbcType=INTEGER},
		bus_pv = #{busPv,jdbcType=INTEGER},
		lon = #{lon,jdbcType=DOUBLE},
		lat = #{lat,jdbcType=DOUBLE},
		create_time
		= #{createTime,jdbcType=TIMESTAMP},
		update_time =
		#{updateTime,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=INTEGER}
	</update>
	
	<resultMap id="ExtResultMap" extends="BaseResultMap" type="com.bt.om.entity.vo.AdSeatInfoVo">
		<result column="media_name" jdbcType="VARCHAR" property="mediaName"/>
		<result column="name" jdbcType="VARCHAR" property="name"/>
		<result column="typename" jdbcType="VARCHAR" property="typeName"/>
		<result column="sex" jdbcType="INTEGER" property="sex"/>
		<result column="age_part" jdbcType="INTEGER" property="agePart"/>
		<result column="mediaid" jdbcType="INTEGER" property="mediaId"/>
		<result column="typeid" jdbcType="INTEGER" property="typeId"/>
	</resultMap>

	<select id="getPageCount" parameterType="map" resultType="int">
		select
		count(a.id)
		from ad_seat_info as a
		left join ad_media as b on a.media_id=b.id
		left join ad_seat_type as c on a.ad_seat_type=c.id
		left join (select * FROM ad_crowd limit 1) d on d.ad_seat_id=a.id
		 where 1=1
	    <if test="province != null" >
	      and a.province = #{province,jdbcType=BIGINT}
	    </if>
	    <if test="city != null" >
	      and a.city = #{city,jdbcType=BIGINT}
	    </if>
	    <if test="region != null" >
	      and a.region = #{region,jdbcType=BIGINT}
	    </if>
	    <if test="street != null" >
	      and a.street = #{street,jdbcType=BIGINT}
	    </if>
	    <if test="mediaId != null" >
	      and b.id = #{mediaId,jdbcType=INTEGER}
	    </if>
		<if test="userId != null" >
			and b.user_id = #{userId,jdbcType=INTEGER}
		</if>
		<if test="adCode != null" >
			and a.ad_code = #{adCode,jdbcType=VARCHAR}
		</if>
		<if test="exceptId != null" >
			and a.id &lt;> #{exceptId,jdbcType=INTEGER}
		</if>
		order by a.id asc
	</select>

	<select id="getPageData" parameterType="map" resultMap="ExtResultMap">
		select
			a.id, a.name, a.province, a.city, a.region, a.street, a.media_id, a.ad_seat_type, a.ad_seat_type_text,
			a.ad_code, a.location,
			a.ad_size, a.pv, a.private_car_pv, a.bus_pv, a.lon, a.lat,
			a.create_time, a.update_time,
			b.media_name,
			c.name as typeName
		from
			ad_seat_info as a
			left join ad_media as b on a.media_id=b.id
			left join ad_seat_type as c on a.ad_seat_type=c.id
			left join (select * FROM ad_crowd limit 1) d on d.ad_seat_id=a.id
		 where 1=1
	    <if test="province != null" >
	      and a.province = #{province,jdbcType=BIGINT}
	    </if>
	    <if test="city != null" >
	      and a.city = #{city,jdbcType=BIGINT}
	    </if>
	    <if test="region != null" >
	      and a.region = #{region,jdbcType=BIGINT}
	    </if>
	    <if test="street != null" >
	      and a.street = #{street,jdbcType=BIGINT}
	    </if>
	    <if test="mediaId != null" >
	      and b.id = #{mediaId,jdbcType=INTEGER}
	    </if>
		<if test="userId != null" >
			and b.user_id = #{userId,jdbcType=INTEGER}
		</if>
		<if test="adCode != null" >
			and a.ad_code = #{adCode,jdbcType=VARCHAR}
		</if>
		<if test="exceptId != null" >
			and a.id &lt;> #{exceptId,jdbcType=INTEGER}
		</if>
		order by a.id asc
	</select>
	
	<select id="getAdSeatInfoById" parameterType="Integer" resultMap="ExtResultMap">
		select
			a.name,
			a.province,
			a.city,
			a.region,
			a.street,
			b.media_name,
			a.ad_code,
			a.location,
			a.ad_size,
			a.pv,
			c.name as typename,
			a.private_car_pv,
			a.bus_pv,
			a.lon,
			a.lat,
			b.id as mediaid,
			c.id as typeid
		from
			ad_seat_info as a
			left join ad_media as b on a.media_id=b.id
			left join ad_seat_type as c on a.ad_seat_type=c.id
		where a.id=#{id,jdbcType=INTEGER}
	</select>

	<select id="getAdSeatInfoByStreetAndMediaUserId" resultMap="BaseResultMap">
		select a.id, a.name, a.province, a.city, a.region, a.street, a.media_id, a.ad_seat_type,
		a.ad_code, a.location,
		a.ad_size, a.pv, a.private_car_pv, a.bus_pv, a.lon, a.lat,
		a.create_time, a.update_time
		from ad_seat_info a
		left join ad_media b on a.media_id = b.id
		where b.user_id = #{userId,jdbcType=INTEGER}
		and a.street = #{street,jdbcType=BIGINT}
		order by id;
	</select>

	<select id="getAdSeatInfoByAdActivitySeatId" resultMap="BaseResultMap">
		select a.id, a.name, a.province, a.city, a.region, a.street, a.media_id, a.ad_seat_type,
		a.ad_code, a.location,
		a.ad_size, a.pv, a.private_car_pv, a.bus_pv, a.lon, a.lat,
		a.create_time, a.update_time
		from ad_seat_info a
		left join ad_activity_adseat b on a.id = b.ad_seat_id
		where b.id = #{adActivitySeatId,jdbcType=INTEGER}
	</select>

	<select id="getCountByAdCode" resultType="int">
		select count(a.id)
		from ad_seat_info a
		where a.ad_code = #{adSeatCode,jdbcType=VARCHAR}
	</select>
	
	<insert id="insertBatchByExcel" parameterType="com.bt.om.entity.AdSeatInfo">
		insert into ad_seat_info (name, province,
		city, region, street,
		media_id, ad_seat_type, ad_seat_type_text, ad_code,
		location, ad_size, pv,
		private_car_pv,
		bus_pv, lon,
		lat, map_standard, 
		create_time, update_time
		)
		values
		<foreach collection="adSeatInfos" item="info" separator=",">  
            (#{info.name,jdbcType=VARCHAR},
			#{info.province,jdbcType=BIGINT},
			#{info.city,jdbcType=BIGINT},
			#{info.region,jdbcType=BIGINT}, #{info.street,jdbcType=BIGINT},
			#{info.mediaId,jdbcType=INTEGER}, #{info.adSeatType,jdbcType=INTEGER},
			#{info.adSeatTypeText,jdbcType=VARCHAR},
			#{info.adCode,jdbcType=VARCHAR},
			#{info.location,jdbcType=VARCHAR},
			#{info.adSize,jdbcType=VARCHAR}, #{info.pv,jdbcType=INTEGER},
			#{info.privateCarPv,jdbcType=INTEGER}, #{info.busPv,jdbcType=INTEGER},
			#{info.lon,jdbcType=DOUBLE},
			#{info.lat,jdbcType=DOUBLE},
			#{info.mapStandard,jdbcType=INTEGER},
			#{info.createTime,jdbcType=TIMESTAMP}, #{info.updateTime,jdbcType=TIMESTAMP}
			)
        </foreach>
	</insert>
	
</mapper>